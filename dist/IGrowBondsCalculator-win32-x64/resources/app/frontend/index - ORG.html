<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Bond Comparison Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url("https://fonts.googleapis.com/css?family=Montserrat:500,400,600");

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }

    body {
      min-height: 100vh;
      background: white;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    main {
      width: 100%;
      max-width: 1280px;
      padding: 96px 32px 64px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
    }

    .header {
      width: 100%;
      max-width: 842px;
      text-align: center;
    }

    .subtitle {
      color: #a11d23;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: -0.28px;
      margin-bottom: 12px;
    }

    h1 {
      font-size: 40px;
      font-weight: 600;
      letter-spacing: -0.8px;
      line-height: 48px;
      margin-bottom: 12px;
    }

    .description {
      color: #404040;
      font-size: 16px;
      letter-spacing: -0.32px;
    }


    .input-card {
      width: 1000px;
      background: white;
      border: 1px solid #cccccc;
      border-radius: 12px;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .input-section {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: auto;
    }

    .input-label {
      color: #b7364a;
      font-size: 14px;
      font-weight: 500;
    }

    .input-control {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .input-value {
      font-size: 14px;
      font-weight: 600;
      height: 25px;
      width: 130px;
      padding: 8px;
      border: 1px solid #B7364B;
      border-radius: 4px;
    }

    .number-controls {
      display: flex;
      gap: 8px;
    }

    .control-btn {
      width: 32px;
      height: 32px;
      border: 1px solid #e6e6e6;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #666;
    }

    .separator {
      width: 1px;
      height: 40px;
      background: #e6e6e6;
      margin: 0 24px;
    }

    .primary-btn {
      background: #b7364a;
      color: white;
      border: none;
      border-radius: 999px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      text-transform: uppercase;
      transition: background-color 0.2s ease;
    }

    .primary-btn:hover {
      background: #a11d23;
    }

    .comparison-cards {
      display: flex;
      gap: 32px;
      width: 842px;
    }

    .card {
      flex: 1;
      padding: 24px;
      border-radius: 12px;
      color: white;
    }

    .igrow-card {
      background: #a11d23;
    }

    .competitor-card {
      background: #0d63c9;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .card-title {
      font-size: 24px;
      font-weight: 600;
    }

    .switch-btn {
      background: rgba(255, 255, 255, 0.32);
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }

    .comparison-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.32);
    }

    .earnings-section {
      margin-top: 24px;
    }

    .earnings-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .large-value {
      font-size: 20px;
      font-weight: 600;
    }

    .secondary-btn {
      bottom: 64px;
      right: 64px;
      background: transparent;
      border: none;
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      transition: background-color 0.2s ease;
    }

    .secondary-btn:hover {
      background: #E6E6E6;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <main>
    <div class="header">
      <div class="subtitle">CALCULATE CLIENT POTENTIAL</div>
      <h1>Bond Comparison Calculator</h1>
      <div class="description">See how IGrow compares to competitors and maximise your sales returns.</div>
    </div>

    <div class="input-card">
      <div class="input-section">
        <div class="input-group">
          <div class="input-label">Number of Properties</div>
          <div class="input-control">
            <input id="propCount" type="number" class="input-value" value="5">
            <!-- <div class="number-controls">
              <button class="control-btn">âˆ’</button>
              <button class="control-btn">+</button>
            </div> -->
          </div>
        </div>

        <div class="separator"></div>

        <div class="input-group">
          <div class="input-label">Average Property Value (R)</div>
          <input id="avgPropValue" class="input-value" value="R10,000,000.00">
        </div>

        <div class="separator"></div>

        <div class="input-group">
          <div class="input-label">Rate (%)</div>
          <div class="input-section">
            <input class="input-value" type="number" id="rate" value="0.50" min="0" max="100" step="0.01" />
            <span style="font-weight: 600;">%</span>
          </div>
        </div>

      </div>

      <button id="calc" class="primary-btn" onclick="calculate()" >Calculate</button>
    </div>

    <div class="comparison-cards">
      <div class="card igrow-card">
        <div class="card-header">
          <div class="card-title">IGROW</div>
        </div>
        <div class="comparison-row">
          <div>Rate</div>
          <div>0.50%</div>
        </div>
        <div class="comparison-row">
          <div>Commission</div>
          <div>R 150,000.00</div>
        </div>
        <div class="comparison-row">
          <div>Transfer Incentive</div>
          <div id="transferIncentive">R 0.09</div>
        </div>
        <div class="comparison-row">
          <div>Total Commission</div>
          <div>R 150,000.09</div>
        </div>
        <div class="comparison-row">
          <div>Revenue Rate</div>
          <div>0.63%</div>
        </div>
        <div class="earnings-section">
          <div class="earnings-title">Total Earnings</div>
          <div class="comparison-row">
            <div>Per Month</div>
            <div class="large-value">R 300,000.00</div>
          </div>
          <div class="comparison-row">
            <div>Per Anum</div>
            <div class="large-value">R 3,600,000.00</div>
          </div>
        </div>
      </div>

      <div class="card competitor-card">
        <div class="card-header">
          <div class="card-title">Competitor 1</div>
          <button class="switch-btn">SWITCH</button>
        </div>
        <div class="comparison-row">
          <div>Rate</div>
          <div>0.40%</div>
        </div>
        <div class="comparison-row">
          <div>Commission</div>
          <div>R 150,000.00</div>
        </div>
        <div class="comparison-row">
          <div>Transfer Incentive</div>
          <div>R 0.00</div>
        </div>
        <div class="comparison-row">
          <div>Total Commission</div>
          <div>R 150,000.00</div>
        </div>
        <div class="comparison-row">
          <div>Revenue Rate</div>
          <div>0.00%</div>
        </div>
        <div class="earnings-section">
          <div class="earnings-title">Total Earnings</div>
          <div class="comparison-row">
            <div>Per Month</div>
            <div class="large-value">R 150,000.00</div>
          </div>
          <div class="comparison-row">
            <div>Per Anum</div>
            <div class="large-value">R 1,800,000.00</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <button class="secondary-btn" onclick="downloadPDF()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 6 2 18 2 18 9"></polyline>
      <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
      <rect x="6" y="14" width="12" height="8"></rect>
    </svg>
    PRINT
  </button>

  <script>
  // Handle increment/decrement
  const controlBtns = document.querySelectorAll('.control-btn');
  const numInput = document.querySelector('.input-control .input-value');

  let number = parseInt(numInput.textContent.trim());


  // Make property value editable with currency symbol
  const propValueContainer = document.querySelectorAll('.input-value')[1];
  const initialPropValue = propValueContainer.textContent;

  const propInput = document.createElement('input');
  propInput.type = 'text';
  propInput.value = initialPropValue.replace(/[^0-9,.]/g, '');
  propInput.style.border = 'none';
  propInput.style.outline = 'none';
  propInput.style.fontWeight = '600';
  propInput.style.fontSize = '16px';
  propInput.style.width = '120px';

  propValueContainer.textContent = 'R';
  propValueContainer.appendChild(propInput);

  function calculate() {
  let rate = parseFloat(document.getElementById("rate").value) || 0;
  let rawValue = document.getElementById("avgPropValue").value;
  let AVGPropValue = parseFloat(rawValue.replace(/[R,\s]/g, '')) || 0;
  let propertyCount = parseInt(document.getElementById("propCount").value) || 0;

  let comm = AVGPropValue * propertyCount * rate * 0.01;
  let propTotal = parseFloat(AVGPropValue * propertyCount) || 0;
  alert("1st propTotal: "+propTotal);

  const formattedComm = "R " + comm.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
  const igrowCardRows = document.querySelectorAll(".igrow-card .comparison-row");
  igrowCardRows.forEach(row => {
    if (row.children[0]?.textContent?.trim() === "Commission") {
      row.children[1].textContent = formattedComm;
    }
  });

  const data = { rate, propTotal };
  alert("Rate: "+rate+ "Total: "+propTotal);
  fetch("http://127.0.0.1:5001/calculate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert("Error: " + data.error);
        return;
      }

      const results = data.results;

      results.parameters.forEach(([key, value]) => {
  if (key === "TransferIncentive") {
    const formattedValue = "R " + value.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, "$&,");
    document.getElementById("transferIncentive").textContent = formattedValue;
  }
});

    })
    .catch(error => {
      console.error("Error:", error);
      alert("An error occurred while calculating. Please try again.");
    });
}
        
        function downloadPDF() {
    const downloadButton = document.querySelector('.secondary-btn');
    downloadButton.style.display = 'none'; // Hide button during PDF generation

    const content = document.body.cloneNode(true); // Clone to avoid layout shift
    content.querySelector('.secondary-btn').remove(); // Remove button from cloned node

    // Add temporary top margin to create space at the top
    const spacer = document.createElement('div');
    spacer.style.height = '40px'; // Adjust this value for more or less space
    content.insertBefore(spacer, content.firstChild);

    // Remove any empty space at the bottom
    const removeEmptySpace = document.createElement('div');
    removeEmptySpace.style.height = '1px'; // Avoid overflow causing blank pages
    content.appendChild(removeEmptySpace);

    // Use timeout to allow rendering
    setTimeout(() => {
        html2pdf().set({
            margin: 1, // Adjusted for better margins
            filename: 'IGrow Bonds Comparison.pdf',
            image: { type: 'png', quality: 1 },
            html2canvas: {
                scale: 1,
                useCORS: true,
                scrollY: 0,
                windowWidth: document.body.scrollWidth, // Ensure no extra width
                windowHeight: document.body.scrollHeight // Capture only visible content
            },
            jsPDF: {
                unit: 'pt',
                format: 'a3',
                orientation: 'landscape'
            },
            pagebreak: {
                avoid: 'div',
                mode: ['css', 'legacy'] // Prevent unnecessary pages
            }
        }).from(content).save().then(() => {
            downloadButton.style.display = 'inline-block';
        });
    }, 500); // Wait 0.5s before capturing
}
  // Observer to toggle download button visibility
  const observer = new MutationObserver(() => {
    const results = document.getElementById("calc");
    const buttonContainer = document.getElementById("downloadContainer");
    if (results.style.display === "block") {
        buttonContainer.style.display = "block";
    } else {
        buttonContainer.style.display = "none";
    }
  });

    observer.observe(document.getElementById("calc"), {attributes: true, attributeFilter: ['style'] });

    const rateInput = document.getElementById("rate");

if (rateInput) {
  rateInput.addEventListener("blur", () => {
    let val = parseFloat(rateInput.value);
    if (isNaN(val) || val < 0) val = 0;
    if (val > 100) val = 100;
    rateInput.value = val.toFixed(2);

    const newRate = rateInput.value + "%";
    const igrowCardRows = document.querySelectorAll(".igrow-card .comparison-row");

    igrowCardRows.forEach(row => {
      if (row.children[0]?.textContent?.trim() === "Rate") {
        row.children[1].textContent = newRate;
      }
    });
  });
}
  
</script>

</body>
</html>